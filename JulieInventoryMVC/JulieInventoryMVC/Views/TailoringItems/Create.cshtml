@using JulieInventoryMVC.App_Resources;
@{
    ViewBag.Title = "Create";
}
@section csss{
    <link rel="stylesheet" type="text/css" href="~/Content/files/assets/icon/themify-icons/themify-icons.css">
    <link rel="stylesheet" type="text/css" href="~/Content/files/assets/icon/icofont/css/icofont.css">
    <link rel="stylesheet" type="text/css" href="~/Content/files/bower_components/jquery.steps/css/jquery.steps.css">
    <link rel="stylesheet" type="text/css" href="~/Content/files/assets/css/pages.css">
    <style>
        .wizard > .content {
            background: none !important;
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* Firefox */
        input[type=number] {
            -moz-appearance: textfield;
        }

        table, tr td {
            border: 1px solid red
        }

        tbody {
            display: block;
            height: 300px;
            overflow: auto;
        }

            thead, tbody tr {
                display: table;
                width: 100%;
                table-layout: fixed;
            }

        thead {
            width: calc( 100% - 1em )
        }

        table {
            width: 400px;
        }

        .table td, .table th {
            padding: 0.5rem !important;
        }


        .btn-file {
            position: relative;
            overflow: hidden;
        }

            .btn-file input[type=file] {
                position: absolute;
                top: 0;
                right: 0;
                min-width: 100%;
                min-height: 100%;
                font-size: 100px;
                text-align: right;
                filter: alpha(opacity=0);
                opacity: 0;
                outline: none;
                background: white;
                cursor: inherit;
                display: block;
            }

        #img-upload {
            width: 100%;
        }
    </style>
}
<div class="pcoded-content">
    <div class="page-header card">
        <div class="row align-items-end">
            <div class="col-lg-8">
                <div class="page-header-title">
                    <i class="feather icon-inbox bg-c-blue"></i>
                    <div class="d-inline">
                        <h5>Tailoring Items Master Create</h5>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="page-header-breadcrumb">
                    <ul class=" breadcrumb breadcrumb-title">
                        <li class="breadcrumb-item">
                            <a href="/Home/Index"><i class="feather icon-home"></i></a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="#!"> @GlobalRes.Master</a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="#!">Tailoring Items Master Create</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="pcoded-inner-content">
        <div class="main-body">
            <div class="page-wrapper">
                <div class="page-body">
                    <div class="row">
                        @* <form class="form-material" id="myForm">*@
                        <div class="col-sm-7" style="float:left;">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Tailoring Item Details</h5>
                                </div>
                                <div class="col-lg-12 col-xl-12">
                                    <div class="mail-body">
                                        <div class="mail-body">
                                            <div class="mail-body-content">
                                                <div class="form-group form-primary">
                                                    <input type="text" name="ProductName" id="ProductName" class="form-control" required>
                                                    <span class="form-bar"></span>
                                                    <label class="float-label">Product / Item Name</label>
                                                </div>
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-md-3">
                                                            <div class="form-group form-primary">
                                                                <input type="number" name="CustomerRate" id="CustomerRate" class="form-control" required>
                                                                <span class="form-bar"></span>
                                                                <label class="float-label">Customer Rate</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="form-group form-primary">
                                                                <input type="number" name="Alter" id="Alter" class="form-control" required>
                                                                <span class="form-bar"></span>
                                                                <label class="float-label">Alter</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-group form-primary">
                                                                <input type="number" name="UnitHrs" id="UnitHrs" class="form-control" required>
                                                                <span class="form-bar"></span>
                                                                <label class="float-label">Unit / Hrs</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-group form-primary">
                                                                <input type="number" name="SrNo" id="SrNo" class="form-control" required>
                                                                <span class="form-bar"></span>
                                                                <label class="float-label"> Sr. No.</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <div class="form-group form-primary">
                                                                <input type="number" name="Barcode" id="Barcode" class="form-control" required>
                                                                <span class="form-bar"></span>
                                                                <label class="float-label">Barcode</label>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="row">

                                                        <div class="col-lg-7" style="float:left">
                                                            <div class="card-block">
                                                                <div class="dt-responsive table-responsive">
                                                                    <button id="addBtn" type="button" class="btn waves-effect waves-dark btn-primary btn-outline-primary" style="margin-bottom:5px">
                                                                        <i class="icofont icofont-plus-circle"></i>
                                                                        Add
                                                                    </button>
                                                                    <table id="tblMeasurement" class="table table-striped table-bordered">
                                                                        <thead>
                                                                            <tr>
                                                                                <th style="width:40px">Sr.</th>
                                                                                <th style="width:100%">Measurement Parameters</th>
                                                                                <th style="width:40%">Action</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody id="tMeasurement" style="width:96%">
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-lg-5" style="float:right">
                                                            <div class="row">
                                                                <div class="col-md-5">
                                                                    <div class="form-group form-primary">
                                                                        <input type="number" name="CustomerRate" id="CustomerRate" class="form-control" required>
                                                                        <label class="float-label">Customer Rate</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-5">
                                                                    <div class="form-group form-primary">
                                                                        <input type="number" name="GST" id="GST" class="form-control" required>
                                                                        <label class="float-label">GST %</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-12">
                                                                    <div class="form-group form-primary">
                                                                        <select name="ItemGroup" id="ItemGroup" class="form-control">
                                                                            <option value="0">Select Item Group</option>
                                                                            @foreach (var item in ViewBag.GetItemGroupMaster)
                                                                            {
                                                                                <option value="@item.ItemGroupId">@item.ItemGroupName</option>
                                                                            }
                                                                        </select>
                                                                        <label class="float-label">Item Group</label>
                                                                    </div>
                                                                </div>

                                                                <div class="col-md-5">
                                                                    <div class="form-group form-primary">
                                                                        <select name="UOM" id="UOM" class="form-control">
                                                                            <option value="0">Select UOM</option>
                                                                            @foreach (var item in ViewBag.GetMiscMaster)
                                                                            {
                                                                                <option value="@item.MiscId">@item.MiscName</option>
                                                                            }
                                                                        </select>
                                                                        <label class="float-label">UOM</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-5">
                                                                    <div class="checkbox-fade fade-in-primary" style="margin-top:10%">
                                                                        <label>
                                                                            <input type="checkbox" id="IsActive" name="IsActive" value="1" class="input-danger">
                                                                            <span class="cr">
                                                                                <i class="cr-icon icofont icofont-ui-check txt-primary"></i>
                                                                            </span>
                                                                            <span>Is Active</span>
                                                                        </label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-12">
                                                                    <div class="input-group">
                                                                        <span class="input-group-btn">
                                                                            <span class="btn btn-default btn-file">
                                                                                Browse… <input type="file" id="imgInp">
                                                                            </span>
                                                                        </span>
                                                                        <input type="text" class="form-control" readonly>
                                                                        <input type="hidden" id="hdnImage">
                                                                    </div>
                                                                    <img id='img-upload' />
                                                                </div>
                                                                <br>
                                                                <br>
                                                                <div class="col-md-12 card-header " style="text-align: center; background-color: #b9b9b9; margin-bottom: 15px;">
                                                                    <h5>Worker Rates</h5>
                                                                </div>
                                                                
                                                                <div class="col-md-5">
                                                                    <div class="form-group form-primary">
                                                                        <input type="number" name="CuttingPcs" id="CuttingPcs" class="form-control" required>
                                                                        <span class="form-bar"></span>
                                                                        <label class="float-label">Cutting / Pcs</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-5">
                                                                    <div class="form-group form-primary">
                                                                        <input type="number" name="SewingPcs" id="SewingPcs" class="form-control" required>
                                                                        <span class="form-bar"></span>
                                                                        <label class="float-label">Sewing / Pcs</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-5">
                                                                    <div class="form-group form-primary">
                                                                        <input type="number" name="SewingR" id="SewingR" class="form-control" required>
                                                                        <span class="form-bar"></span>
                                                                        <label class="float-label">Sewing (R)</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-5">
                                                                    <div class="form-group form-primary">
                                                                        <input type="number" name="Material" id="Material" class="form-control" required>
                                                                        <span class="form-bar"></span>
                                                                        <label class="float-label">Material</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-5">
                                                                    <div class="form-group form-primary">
                                                                        <input type="number" name="SewingJW" id="SewingJW" class="form-control" required>
                                                                        <span class="form-bar"></span>
                                                                        <label class="float-label">Sewing JW</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-5">
                                                                    <div class="form-group form-primary">
                                                                        <input type="number" name="AlterCharg" class="form-control" required>
                                                                        <span class="form-bar"></span>
                                                                        <label class="float-label">Alter Charge.</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-5">
                                                                    <div class="form-group form-primary">
                                                                        <input type="number" name="SewingJWR" id="SewingJWR" class="form-control" required>
                                                                        <span class="form-bar"></span>
                                                                        <label class="float-label">Sewing JW (R)</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-5">
                                                                    <div class="form-group form-primary">
                                                                        <input type="number" name="AlterR" id="AlterR" class="form-control" required>
                                                                        <span class="form-bar"></span>
                                                                        <label class="float-label">Alter (R)</label>
                                                                    </div>
                                                                </div>

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-5" style="float:right;">
                            <div class="card">
                                <div class="card-block">
                                    <div class="dt-responsive table-responsive">
                                        <button id="addNoteBtns" type="button" class="btn waves-effect waves-dark btn-primary btn-outline-primary" style="margin-bottom:5px">
                                            <i class="icofont icofont-plus-circle"></i>
                                            Add
                                        </button>
                                        <table id="tblNotes" class="table table-striped table-bordered">
                                            <thead>
                                                <tr>
                                                    <th style="width:40px">Sr.</th>
                                                    <th style="width:100%">Notes / Styles</th>
                                                    <th style="width:60%">Charge</th>
                                                    <th style="width:70%">Charge(W)</th>
                                                    <th style="width:75%">Charge(JW)</th>
                                                    <th style="width:40%">Action</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tNotes" style="width:100%">
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="card-block" style="float:right">
                                        <button class="btn waves-effect waves-light btn-success btn-outline-success" id="SaveBtn">
                                            <i class="icofont icofont-check-circled"></i>Save
                                        </button>
                                        <button class="btn waves-effect waves-light btn-danger btn-outline-danger">
                                            <i class="icofont icofont-eye-alt"></i>Cancel
                                        </button>
                                    </div>

                                </div>
                            </div>
                        </div>
                        @* </form>*@
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@section scripts{

    <script src="~/Content/files/bower_components/modernizr/js/modernizr.js" type="text/javascript"></script>
    <script src="~/Content/files/bower_components/modernizr/js/css-scrollbars.js" type="text/javascript"></script>
    <script src="~/Content/files/assets/js/pcoded.min.js"></script>


    <script src="~/Content/files/bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="~/Content/files/bower_components/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="~/Content/files/bower_components/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script>

        ; (function ($) {
            let counts = 1;
            var imgs = "";
            $('#addNoteBtns').click(function () {
                let dynamicRowHTML = `     <tr class="rowClass ">
                                                                                    <td class="row-index text-center Field" style="width:40px">
                                                                                         ${counts}
                                                                                    </td>
                                                                                    <td class="row-index text-center Field" style="width:100%">
                                                                                         <input type="text" name="Notes${counts}"id="Notes${counts}" class="form-control" >
                                                                                    </td>
                                                                                    <td class="row-index text-center Field" style="width:60%">
                                                                                         <input type="number" name="Charge${counts}"id="Charge${counts}" class="form-control" >
                                                                                    </td>
                                                                                    <td class="row-index text-center Field" style="width:70%">
                                                                                         <input type="number" name="ChargeW${counts}"id="ChargeW${counts}" class="form-control" >
                                                                                    </td>
                                                                                    <td class="row-index text-center Field" style="width:75%">
                                                                                         <input type="number" name="ChargeJW${counts}"id="ChargeJW${counts}" class="form-control" >
                                                                                    </td>
                                                                                    <td class="text-center"style="width:40%">
                                                                                        <button class="btn btn-danger remove" type="button">
                                                                                            <i class="fa fa-trash" aria-hidden="true"></i>
                                                                                        </button>
                                                                                    </td>
                                                                               </tr>`;
                $('#tNotes').append(dynamicRowHTML);
                counts++;
            });

            $('#tNotes').on('click', '.remove', function () {
                $(this).parent('td.text-center').parent('tr.rowClass').remove();
            });

            let count = 1;
            $('#addBtn').click(function () {
                let dynamicRowHTML = `  <tr class="rowClass"">
                                                                                                         <td class="row-index text-center" style="width:40px">
                                                                                                              ${count}
                                                                                                         </td>
                                                                                                         <td class="row-index text-center Field" style="width:100%">
                                                                                                              <input type="text" name="Measurement" id="Measurement" class="form-control" >
                                                                                                         </td>
                                                                                                         <td class="text-center"style="width:32%">
                                                                                                             <button class="btn btn-danger remove"
                                                                                                                 type="button"><i class="fa fa-trash" aria-hidden="true"></i>
                                                                                                             </button>
                                                                                                         </td>
                                                                                                     </tr>`;
                $('#tMeasurement').append(dynamicRowHTML);
                count++;
            });

            $('#tMeasurement').on('click', '.remove', function () {
                $(this).parent('td.text-center').parent('tr.rowClass').remove();
            });

            $("#SaveBtn").on('click', function (e) {
                var measurement = [];
                $('#tblMeasurement tbody tr').each(function () {
                    var obj = {}
                    obj["PrintOrder"] = $(this).find("td:eq(0)").text().trim();
                    obj["ParaName"] = $(this).find("td:eq(1) input").val();

                    measurement.push(obj)
                });

                var notes = [];
                $('#tblNotes tbody tr').each(function () {
                    var obj = {}
                    obj["PrintOrder"] = $(this).find("td:eq(0)").text().trim();
                    obj["ParaName"] = $(this).find("td:eq(1) input").val();
                    obj["Charge"] = $(this).find("td:eq(2) input").val();
                    obj["ChargeW"] = $(this).find("td:eq(3) input").val();
                    obj["ChargeJW"] = $(this).find("td:eq(4) input").val();

                    notes.push(obj)
                });

                var productname = $('#ProductName').val();
                var customerrate = $('#CustomerRate').val();
                var alter = $('#Alter').val();
                var onepiecestitchinghrs = $('#UnitHrs').val();
                var srno = $('#SrNo').val();
                var barcode = $('#Barcode').val();
                var gst = $('#GST').val();
                var isactive = $('#IsActive').val();
                var cuttingpcs = $('#CuttingPcs').val();
                var sewingpcs = $('#SewingPcs').val();
                var sewingjwr = $('#SewingJWR').val();
                var sewingr = $('#SewingR').val();
                var material = $('#Material').val();
                var sewingjw = $('#SewingJW').val();
                var alterr = $('#AlterR').val();
                var itemgroupid = $('#ItemGroup').val();
                var uom = $('#UOM').text();

                var dataItemMaster = {
                    TItemName: productname,
                    TItemRate: customerrate,
                    AlterRate: alter,
                    OnePieceStitchingHrs: onepiecestitchinghrs,
                    TItemCode: srno,
                    Barcode: barcode,
                    TaxPer: gst,
                    IsActive: isactive==1?"true":"false",
                    CuttingRate: cuttingpcs,
                    SewingRate: sewingpcs,
                    SewingRate_R: sewingr,
                    SewingRate_Jw: sewingjw,
                    SewingRate_Jw_R: sewingjwr,
                    Material: material,
                    AlterR: alterr,
                    AlterCharge_R: alterr,
                    ItemGroupId: itemgroupid,
                    UOM: uom
                }
                var data =
                {
                    itemMasterJson: dataItemMaster,
                    Parameters: measurement,
                    NotesStyles: notes
                }
                var formData = new FormData();

                var ItemMasterData = JSON.stringify(dataItemMaster);
                var Parameters = JSON.stringify(measurement);
                var NotesStyles = JSON.stringify(notes);
                debugger
                formData.append('ItemMasterData', ItemMasterData);
                formData.append('ParametersData', Parameters);
                formData.append('NotesStylesData', NotesStyles);
                //formData.append("imgFile", imgs.files);
                for (var i = 0; i < imgs.length; i++) {
                    formData.append(files[i].name, imgs[i]);
                }
                $.ajax({
                    url: "/TailoringItems/Creates",
                    type: "POST",
                    contentType: false,
                    processData: false, 
                    data: formData,
                    },
                );
            })

            $(document).on('change', '.btn-file :file', function () {
                var input = $(this),
                    label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
                input.trigger('fileselect', [label]);
            });
            $('.btn-file :file').on('fileselect', function (event, label) {
                var input = $(this).parents('.input-group').find(':text'),
                    log = label;
                if (input.length) {
                    input.val(log);
                } else {
                    if (log) alert(log);
                }
            });

            function readURL(input) {
                imgs = input.files[0];
                if (input.files && input.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        $('#img-upload').attr('src', e.target.result);
                    }
                    reader.readAsDataURL(input.files[0]);
                }
            }

            $("#imgInp").change(function () {
                readURL(this);
            });

        })(jQuery);

    </script>

}